---
import BaseLayout from './BaseLayout.astro';
import FormattedDate from '../components/FormattedDate.astro';
import { Image } from 'astro:assets';
import commercialImage from '../assets/images/commercial/commercial-content-creation-rochester-ny.jpg';
import weddingImage from '../assets/images/weddings/nightfox-films-rochester-ny.jpg';
import heritageImage from '../assets/images/abandoned/abandoned-upstate.jpg';

import type { ImageMetadata } from 'astro';

export interface Props {
  title: string;
  description?: string;
  pubDate: Date;
  updatedDate?: Date;
  author?: string;
  image?: ImageMetadata;
  tags?: string[];
  externalLink?: string;
}

const { title, description, pubDate, updatedDate, author, image, tags = [], externalLink } = Astro.props;
const base = import.meta.env.BASE_URL.endsWith('/') ? import.meta.env.BASE_URL : import.meta.env.BASE_URL + '/';
---

<BaseLayout title={title} description={description} image={image}>
  <article>
    <h1 class="post-title">{title}</h1>
    
    <div class="post-meta">
      {tags.length > 0 && (
        <span class="post-tags">
          {tags.map((tag) => (
            <a href={`${base}tags/${tag}/`}>{tag}</a>
          ))}
        </span>
      )}
    </div>
    
    {(image || title === 'Commercial' || title === 'Wedding Films' || title === 'Historical Research') && (
      <figure class="post-cover">
        {title === 'Commercial' ? (
          <div class="image-overlay-container">
            <Image src={commercialImage} alt={title} inferSize={true} style="width: 100%; height: auto;" />
            <div class="image-overlay-text">Commercial</div>
          </div>
        ) : title === 'Wedding Films' ? (
          externalLink ? (
            <a href={externalLink} class="image-overlay-container" target="_blank" rel="noopener">
              <Image src={weddingImage} alt="Nightfox Films" inferSize={true} style="width: 100%; height: auto;" />
              <div class="image-overlay-text">Nightfox Films</div>
            </a>
          ) : (
            <div class="image-overlay-container">
              <Image src={weddingImage} alt="Nightfox Films" inferSize={true} style="width: 100%; height: auto;" />
              <div class="image-overlay-text">Nightfox Films</div>
            </div>
          )
        ) : title === 'Historical Research' ? (
          externalLink ? (
            <a href={externalLink} class="image-overlay-container" target="_blank" rel="noopener">
              <Image src={heritageImage} alt="Abandoned Upstate" inferSize={true} style="width: 100%; height: auto;" />
              <div class="image-overlay-text">Abandoned Upstate</div>
            </a>
          ) : (
            <div class="image-overlay-container">
              <Image src={heritageImage} alt="Abandoned Upstate" inferSize={true} style="width: 100%; height: auto;" />
              <div class="image-overlay-text">Abandoned Upstate</div>
            </div>
          )
        ) : (
          <Image src={image} alt={title} inferSize={true} style="width: 100%; height: auto;" />
        )}
      </figure>
    )}
    
    <div class="post-content">
      <slot />
    </div>
  </article>
  
  <script>
    // Code copy functionality
    document.addEventListener('DOMContentLoaded', () => {
      const codeBlocks = document.querySelectorAll('pre.astro-code');
      
      codeBlocks.forEach((block) => {
        const wrapper = document.createElement('div');
        wrapper.className = 'highlight';
        block.parentNode?.insertBefore(wrapper, block);
        wrapper.appendChild(block);
        
        const lang = block.getAttribute('data-language') || 'text';
        
        const titleDiv = document.createElement('div');
        titleDiv.className = 'code-title';
        titleDiv.textContent = lang;
        
        if (navigator.clipboard) {
          const button = document.createElement('button');
          button.className = 'copy-button';
          button.textContent = 'Copy';
          
          button.addEventListener('click', async () => {
            const code = block.textContent || '';
            try {
              await navigator.clipboard.writeText(code);
              button.textContent = 'Copied';
              setTimeout(() => {
                button.textContent = 'Copy';
              }, 1000);
            } catch (err) {
              console.error('Failed to copy:', err);
            }
          });
          
          titleDiv.appendChild(button);
        }
        
        wrapper.insertBefore(titleDiv, block);
      });
    });
  </script>
  
  <!-- Twitter embed script -->
  <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</BaseLayout>

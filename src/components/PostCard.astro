---
import { Image } from 'astro:assets';
import vintageImage from '../assets/images/vintage/super-8-film-scanning-rochester-ny.jpg';
import type { ImageMetadata } from 'astro';

export interface Props {
  post: {
    slug: string;
    data: {
      title: string;
      description?: string;
      listingTitle?: string;
      tags?: string[];
      image?: ImageMetadata;
      externalLink?: string;
    };
  };
}

const { post } = Astro.props;
const base = import.meta.env.BASE_URL.endsWith('/') ? import.meta.env.BASE_URL : import.meta.env.BASE_URL + '/';
const displayTitle = post.data.listingTitle ?? post.data.title;
const slug = post.slug;
const forceInternal = slug === 'retro-wedding-videography' || slug === 'abandoned-buildings-ny';
const postUrl = forceInternal ? `${base}services/${post.slug}/` : post.data.externalLink || `${base}services/${post.slug}/`;
const isExternal = !!post.data.externalLink && !forceInternal;
const shouldShowCover = (!forceInternal && post.data.image) || slug === 'vintage-photo-video';
---

<article class="post on-list">
  <h2 class="post-title">
    <a href={postUrl} target={isExternal ? "_blank" : undefined} rel={isExternal ? "noopener" : undefined}>
      {displayTitle}
    </a>
  </h2>
  {post.data.tags && post.data.tags.length > 0 && (
    <span class="post-tags">
      {post.data.tags.map((tag, index) => (
        <>
          <a href={`${base}tags/${tag}/`}>{tag}</a>{index < post.data.tags.length - 1 && ', '}
        </>
      ))}
    </span>
  )}
  {shouldShowCover && (
    <figure class="post-cover">
      {slug === 'vintage-photo-video' ? (
        <a href={postUrl} class="image-overlay-container" target={isExternal ? "_blank" : undefined} rel={isExternal ? "noopener" : undefined}>
          <Image src={vintageImage} alt={post.data.title} inferSize={true} style="width: 100%; height: auto;" />
          <div class="image-overlay-text">Vintage Media</div>
        </a>
      ) : post.data.image ? (
        <Image src={post.data.image} alt={post.data.title} inferSize={true} style="width: 100%; height: auto;" />
      ) : null}
    </figure>
  )}
  {post.data.description && (
    <div class="post-content">
      <p>{post.data.description}</p>
    </div>
  )}
  <div>
    <a href={postUrl} class="read-more button inline" target={isExternal ? "_blank" : undefined} rel={isExternal ? "noopener" : undefined}>
      [Read more]
    </a>
  </div>
</article>

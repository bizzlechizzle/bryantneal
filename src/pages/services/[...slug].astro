---
import { getCollection } from 'astro:content';
import PostLayout from '../../layouts/PostLayout.astro';

export async function getStaticPaths() {
  const ordering = new Map([
    ['Vintage Media', 0],
    ['Commercial', 1],
    ['Wedding Films', 2],
    ['Historical Research', 3],
  ]);

  const allowedSlugs = new Set([
    'vintage-photo-video',
    'commercial-photo-video',
    'retro-wedding-videography',
    'abandoned-buildings-ny',
  ]);

  const services = (await getCollection('services'))
    .filter(service => !service.data.draft && allowedSlugs.has(service.slug))
    .sort((a, b) => {
      const aTitle = a.data.listingTitle ?? a.data.title;
      const bTitle = b.data.listingTitle ?? b.data.title;
      const aRank = ordering.get(aTitle) ?? Number.MAX_SAFE_INTEGER;
      const bRank = ordering.get(bTitle) ?? Number.MAX_SAFE_INTEGER;
      if (aRank !== bRank) return aRank - bRank;
      return aTitle.localeCompare(bTitle);
    });
  
  return services.map((service, index) => ({
    params: { slug: service.slug },
    props: {
      post: service,
      prevPost: index > 0 ? services[index - 1] : null,
      nextPost: index < services.length - 1 ? services[index + 1] : null,
    },
  }));
}

const { post, prevPost, nextPost } = Astro.props;
const { Content } = await post.render();
const base = import.meta.env.BASE_URL.endsWith('/') ? import.meta.env.BASE_URL : import.meta.env.BASE_URL + '/';
---

<PostLayout {...post.data}>
  <Content />
  
  <div class="pagination">
    <div class="pagination__title">
      <span class="pagination__title-h">View more work</span>
      <hr />
    </div>
    <div class="pagination__buttons">
      {prevPost && (
        <>
          <a href={`${base}services/${prevPost.slug}/`} class="button inline prev">
            &lt; [<span class="button__text">{prevPost.data.listingTitle ?? prevPost.data.title}</span>]
          </a>
          {prevPost && nextPost && <span>::</span>}
        </>
      )}
      {nextPost && (
        <a href={`${base}services/${nextPost.slug}/`} class="button inline next">
          [<span class="button__text">{nextPost.data.listingTitle ?? nextPost.data.title}</span>] &gt;
        </a>
      )}
    </div>
  </div>
</PostLayout>
